# CMMI MCP v0.1.8 更新指南

## 🚀 版本更新摘要

**版本**: `v0.1.8`  
**发布时间**: 2024年12月  
**类型**: 修复版本（Agent管理bug修复）

## 🔧 修复内容

### 主要修复
1. **Agent路径解析问题**: 修复了npm临时目录下的agent检测失败问题
2. **Agent状态报告**: 修复了`agent_manage`工具返回"0/6 agents created"的错误
3. **路径回退机制**: 增强了项目路径检测，支持用户主目录回退
4. **现有Agent处理**: 改进了对已存在agent的识别和处理逻辑

### 技术改进
- 增强了`findAgentsDirectory()`函数的路径解析能力
- 优化了`initCMMIAgents()`函数，正确处理已存在的agents
- 改进了调试日志输出，提供更详细的执行信息
- 修复了npm包安装在临时目录时的路径解析问题

## 📦 安装/更新步骤

### 1. 更新全局包
```bash
# 卸载旧版本
npm uninstall -g cmmi-specs-mcp

# 安装最新版本
npm install -g cmmi-specs-mcp@latest
```

### 2. 验证安装
```bash
# 检查版本
cmmi-specs-mcp --version

# 应该显示: CMMI Specs MCP Server v0.1.8
```

### 3. 更新VS Code MCP配置

使用以下配置（推荐使用最新版本固定）：

```json
{
  "mcpServers": {
    "cmmi-specs": {
      "command": "npx",
      "args": ["-y", "cmmi-specs-mcp@0.1.8", "start"]
    }
  }
}
```

或者使用最新版本：

```json
{
  "mcpServers": {
    "cmmi-specs": {
      "command": "npx",
      "args": ["-y", "cmmi-specs-mcp@latest", "start"]
    }
  }
}
```

### 4. 重新加载VS Code
- 按 `Ctrl+Shift+P` (Windows/Linux) 或 `Cmd+Shift+P` (macOS)
- 输入 "Reload Window" 并回车
- 等待MCP服务器重新启动

## 🧪 验证修复效果

### 测试Agent管理功能
1. 在VS Code Copilot Chat中输入：
   ```
   @cmmi 初始化智能agents
   ```

2. 现在应该看到正确的响应：
   ```json
   {
     "success": true,
     "action": "init_cmmi",
     "initialized_agents": ["requirements-agent", "design-agent", "coding-agent", "test-agent", "tasks-agent", "spec-agent"],
     "newly_created_agents": [],
     "existing_agents": [...],
     "message": "CMMI agent initialization completed. Created 0 new agents, found 6 existing agents. Total: 6/6 agents available."
   }
   ```

### 启用调试模式（可选）
如果需要详细的调试信息：

```bash
# 设置调试环境变量
export DEBUG_MCP=true

# 然后重新启动VS Code
```

## 🐛 修复前后对比

### 修复前 (v0.1.7)
- ❌ `agent_manage`返回："Created 0 new agents, found 0 existing agents. Total: 0/6 agents available."
- ❌ 在npm临时目录中无法找到agents
- ❌ 路径解析失败导致功能不可用

### 修复后 (v0.1.8)
- ✅ `agent_manage`正确返回："Created 0 new agents, found 6 existing agents. Total: 6/6 agents available."
- ✅ 正确检测和使用现有的6个CMMI标准agents
- ✅ 路径解析增强，支持多种安装环境
- ✅ 所有8个MCP工具功能正常

## 📋 功能验证清单

完成更新后，请验证以下功能：

- [ ] VS Code MCP服务器正常启动（无错误日志）
- [ ] `@cmmi 初始化智能agents` 返回6/6 agents available
- [ ] `@cmmi 创建项目` 功能正常
- [ ] `@cmmi 分析任务` 功能正常
- [ ] `@cmmi 翻译文档` 功能正常
- [ ] `@cmmi 质量分析` 功能正常
- [ ] 所有agent工具可正常调用

## 🆘 问题排查

如果更新后仍有问题：

1. **清理缓存**:
   ```bash
   npm cache clean --force
   npx clear-npx-cache
   ```

2. **重新安装**:
   ```bash
   npm uninstall -g cmmi-specs-mcp
   npm install -g cmmi-specs-mcp@0.1.8
   ```

3. **检查VS Code MCP日志**:
   - 打开VS Code开发者工具
   - 查看Console中的MCP相关日志

4. **启用调试模式**获取详细信息

## 📞 技术支持

如果遇到问题，请提供：
- VS Code版本
- 操作系统信息
- MCP服务器日志
- 具体错误信息

---

**感谢使用CMMI MCP工具！现在所有agent管理功能都应该正常工作了。** 🎯
